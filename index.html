<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Monster, within, you — a quiet experiment in radical honesty. Essays and anonymous letters exploring the parts of ourselves we avoid.">
  <title>Monster, within, you</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- Accessibility: skip link is present but visually hidden by default.
       It becomes visible when focused (keyboard users). -->
  <a class="skip-link" href="#content">Skip to content</a>

  <div class="layout">
    <aside class="sidebar" role="navigation" aria-label="Primary">
      <div class="sidebar-title">monsterwithinyou</div>
      <nav class="sidebar-nav" id="sidebar-nav" aria-label="Primary navigation">
        <!-- Navigation is populated dynamically from the repository contents. -->
        <!-- Falls back to a small static list if the GitHub API cannot be reached. -->
      </nav>
    </aside>
    <main id="content">
      <header>
        <div class="eyebrow">A quiet experiment in radical honesty</div>
        <h1>
          <span class="accent">Monster,</span> within, you
        </h1>
      </header>

      <section>
        <p>
          This is a placeholder
        </p>
      </section>

      <footer>
        <div class="pill">You are not being watched here. Only reflected.</div>
        <!-- <div>First draft of the experiment · v0.1</div> -->
      </footer>
    </main>
  </div>

  <script>
  (async function(){
    const owner = 'Iamthemonster';
    const repo = 'monsterwithinyou';
    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents`;
    const sidebar = document.getElementById('sidebar-nav');

    function createLink(href, label, isActive){
      const a = document.createElement('a');
      a.href = href;
      a.textContent = label;
      if (isActive) {
        a.classList.add('active');
        a.setAttribute('aria-current','page');
      }
      return a;
    }

    function addHome(){
      sidebar.appendChild(createLink('/', 'homepage', location.pathname === '/' || location.pathname === '/index.html'));
    }

    function fallbackNav(){
      addHome();
      sidebar.appendChild(createLink('/day1/', 'day 1', location.pathname.startsWith('/day1')));
    }

    try {
      const res = await fetch(apiUrl, { headers: { 'Accept': 'application/vnd.github.v3+json' } });
      if (!res.ok) throw new Error('GitHub API error: ' + res.status);
      const items = await res.json();

      addHome();

      const dayDirs = items
        .filter(it => it.type === 'dir' && /^day\\d+$/i.test(it.name))
        .map(it => it.name)
        .sort((a,b) => {
          const na = Number((a.match(/\\d+/) || [0])[0] || 0);
          const nb = Number((b.match(/\\d+/) || [0])[0] || 0);
          return na - nb;
        });

      const dayFiles = items
        .filter(it => it.type === 'file' && /^day\\d+(?:\.html|\.md)?$/i.test(it.name))
        .map(it => it.name.replace(/\.html|\.md$/i, ''))
        .sort((a,b) => Number((a.match(/\\d+/)||[0])[0]) - Number((b.match(/\\d+/)||[0])[0]));

      if (dayDirs.length > 0) {
        dayDirs.forEach(dir => {
          const href = `/${dir}/`;
          const label = dir.replace(/^day(\\d+)$/i, 'day $1');
          sidebar.appendChild(createLink(href, label, location.pathname.startsWith(`/${dir}/`) || location.pathname.startsWith(`/${dir}`)));
        });
      } else if (dayFiles.length > 0) {
        dayFiles.forEach(name => {
          const href = `/${name}/`;
          const label = name.replace(/^day(\\d+)$/i, 'day $1');
          sidebar.appendChild(createLink(href, label, location.pathname.startsWith(`/${name}/`) || location.pathname.startsWith(`/${name}`)));
        });
      }

      const hasDay1 = Array.from(sidebar.querySelectorAll('a')).some(a => /day\\s*1/i.test(a.textContent));
      if (!hasDay1) {
        sidebar.appendChild(createLink('/day1/', 'day 1', location.pathname.startsWith('/day1')));
      }
    } catch (err) {
      console.error('Could not build sidebar navigation from GitHub API, using fallback.', err);
      sidebar.innerHTML = '';
      fallbackNav();
    }
  })();
  </script>
</body>
</html>
